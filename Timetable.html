<html>
	<head>
		<title>Transport API</title>		
	</head>
	<body>
		<h1>Timetable</h1>		

			Start:
			<input type="text" name="start" maxlength="50" value="Amsoldingen, Kreuz"><br>
			<!--Ziel:
			<input type="text" name="destination" maxlength="50" value="Biel, Höhenweg"><br>-->
			<button onclick="doStuff()">Suche</button>

			<div name="results"></div>
		
		
		<script src = GoogleCalendarTest.html></script>
		
		<script>
		function getConnection (start, destination, datetime, callback) {
			var request = new XMLHttpRequest();
			request.open('GET', 'http://transport.opendata.ch/v1/connections?from='+start+'&to='+destination+'&time='+datetime.getHours()+':'+datetime.getMinutes()+'&isArrivalTime=1', true);

			request.onload = function() {
				if (this.status >= 200 && this.status < 400) {
				// Success!
					var data = JSON.parse(this.response);
					callback(data.connections[1]);
				} else {
				// We reached our target server, but it returned an error

				}
			};

			request.onerror = function() {
				// There was a connection error of some sort
			};

			request.send();
		}

		function doStuff() {
			
			var start = document.getElementsByName("start")[0].value;
			//var destination = document.getElementsByName("destination")[0].value;
			var destination = event.location;
			console.log(destination)
			var zeitpunkt = new Date (event.getHours(), event.getMinutes())
			var	datetime = new Date (zeitpunkt);
			datetime.setMinutes ( zeitpunkt.getMinutes () - 10 );
			function processResult(value) {
				var departure = new Date (value.from.departure);
				var alertTime = new Date (departure);
				alertTime.setMinutes (departure.getMinutes() - 60);		
				console.log("AlertTime", alertTime);
				var arrival = new Date (value.to.arrival);
				var res = document.getElementsByName('results')[0];
			    res.insertAdjacentHTML('beforeend', '<h1>'+alertTime.getHours()+':'+alertTime.getMinutes()+' Weckzeit</h1><br><h1>'+departure.getHours()+':'+departure.getMinutes()+' Abfahrtszeit</h1><br><h1>'+arrival.getHours()+':'+arrival.getMinutes()+' Ankunftszeit</h1'	)
			}
			getConnection(start, destination, datetime, processResult)
		}

		</script>		
	</body>
</html>